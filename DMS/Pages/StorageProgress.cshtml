@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<div class="progress"><div id="progressBar"></div></div>
<h2 class="storage">
    <span id="usedStorage">0</span>
    <span class="size" id="usedStoragePrefix">MB</span>of
    <span id="maxStorage">10</span>
    <span class="full_size" id="maxStoragePrefix">GB</span>used
</h2>
<script>
    $(document).ready(function () {

        var xmlHttp = new XMLHttpRequest();

        xmlHttp.open("GET", "api/authorization/getuserstorage", false);
        xmlHttp.send();
        storage = JSON.parse(xmlHttp.responseText);

        var usedStorageLbl = document.getElementById('usedStorage');
        var maxStorageLbl = document.getElementById('maxStorage');
        var usedStoragePrefix = document.getElementById('usedStoragePrefix');
        var maxStoragePrefix = document.getElementById('maxStoragePrefix');
        var prefix;
        var usedStorage = storage.UsedStorage;

        if (usedStorage >= 1000) {
            prefix = "GB";
            usedStorage = usedStorage / 1000;
        } else {
            prefix = "MB";
        }


        usedStorageLbl.innerHTML = calc(usedStorage);
        usedStoragePrefix.innerHTML = prefix;

        var maxStorage = storage.Storage;

        if (maxStorage == -1) {
            prefix = "Unlimited";
            maxStorage = null;
        } else {
            prefix = "GB";
            maxStorage = maxStorage / 1000;
        }


        maxStorageLbl.innerHTML = maxStorage;
        maxStoragePrefix.innerHTML = prefix;

            var bar = new ProgressBar.Circle('#progressBar', {
                strokeWidth: 2,
                easing: 'easeInOut',
                duration: 1400,
                color: '#0087FF',
                trailColor: '#eee',
                trailWidth: 1,
            });



            var perc = (storage.UsedStorage / storage.Storage);
            bar.animate(perc);
    })

    function calc(num) {
        var with2Decimals = num.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]
        return with2Decimals;
    }

</script>
<script src="~/js/progressbar.js"></script>
