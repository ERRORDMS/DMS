@page
@model DMS.Pages.ConfigureModel
@{
    ViewData["Title"] = "Configure";
    Layout = null;
}
<html>
<head>
    <link rel="stylesheet" href="~/css/vendor.css" asp-append-version="true" />
    <!-- <link rel="stylesheet" href="~/css/Site.css" />-->
    <script src="~/js/vendor.js" asp-append-version="true"></script>
    <style>
        #devextreme0 {
            height: 40px;
        }
        .dx-texteditor-input {
            height: 40px;
        }
        #devextreme1 {
            height: 40px;
        }
        #devextreme2 {
            height: 40px;
        }
        #devextreme3 {
            height: 40px;
        }
        #devextreme4 {
            height: 40px;
        }
    </style>
</head>
<body>
    <h2 class="content-block">Configuration</h2>

    @(Html.DevExtreme().TextBox()
        .Name("txtIP")
        .ElementAttr("class", "content-block")
        .Placeholder("Service Endpoint"))

    <br />

    @(Html.DevExtreme().TextBox()
        .Name("txtDataSource")
        .ElementAttr("class", "content-block")
        .Placeholder("DataSource"))
    <br />
    @(Html.DevExtreme().TextBox()
        .Name("txtDB")
        .ElementAttr("class", "content-block")
        .Placeholder("Database"))

    <br />
    @(Html.DevExtreme().TextBox()
        .Name("txtPath")
        .ElementAttr("class", "content-block")
        .Placeholder("Databases Path"))

    <br />
    @(Html.DevExtreme().TextBox()
        .Name("Password")
        .ElementAttr("class", "content-block")
        .Placeholder("Password"))

    <br />
    @(Html.DevExtreme().Button()
        .Text("Save")
        .ElementAttr("class", "content-block")
        .Type(ButtonType.Success)
        .Icon("save")
        .OnClick("save"))
    @(Html.DevExtreme().Button()
        .Text("Generate tables & columns")
        .ElementAttr("class", "content-block")
        .Type(ButtonType.Success)
        .Icon("save")
        .OnClick("generate"))
    @(Html.DevExtreme().Button()
        .Text("Fix Extensions")
        .ElementAttr("class", "button3")
        .Type(ButtonType.Success)
        .Icon("save")
        .OnClick("fixExt"))
    <script>

        $(document).ready(function () {

            var json = getSettings();

            var settings = JSON.parse(json);

            $('#txtIP').val(settings.ServiceEndpoint);
            $('#txtDataSource').val(settings.DataSource);
            $('#txtDB').val(settings.Database);
            $('#txtPath').val(settings.DatabasesPath);


            $('#txtDB').focus();
            $('#txtDB').blur();

            $('#txtDataSource').focus();
            $('#txtDataSource').blur();

            $('#txtIP').focus();
            $('#txtIP').blur();


            $('#txtPath').focus();
            $('#txtPath').blur();

            
        });

        function getSettings() {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.open("GET", "api/Settings", false);
                xmlHttp.send();
                return xmlHttp.responseText;
        }

        function generate() {
            if (Password.value == "") {
                alert("enter password pls");
            } else {
                const xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        alert('Generated');
                    }
                }

                xhr.open("POST", 'api/Settings/GenerateTables', true);
                xhr.send();
            }
           
        }


        function fixExt() {
            if (Password.value == "") {
                alert("enter password pls");
            } else {
                const xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        alert('Fixed');
                    }
                }

                xhr.open("POST", 'api/Settings/FixExt', true);
                xhr.send();
            }
        }

        function save() {
            if (Password.value == "") {
                alert("enter password pls");
            } else {
                const xhr = new XMLHttpRequest();

                xhr.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        alert('Saved');
                    }
                }

                xhr.open("POST", 'api/Settings/Save', true);

                const fd = new FormData();

                fd.append('serviceendpoint', txtIP.value);
                fd.append('datasource', txtDataSource.value);
                fd.append('database', txtDB.value);
                fd.append('DatabasesPath', txtPath.value);

                xhr.send(fd);
            }
        }
    </script>

</body>
</html>
    

