@page
@model DMS.Pages.AddContactModel
@{
    ViewData["Title"] = Localizer["Title"];
    Layout = "~/Pages/_Layout.cshtml";
}
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
<head>
    <style>

        .add_contact_form {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .contact_input {
            width: 360px;
        }

        .add_Contact_button {
            width: 100%;
            height: 50px;
            border-radius: 15px;
            outline: none;
            border: none;
            background-image: linear-gradient(to right, rgb(255,87,34), rgb(255,92,38), rgb(255,114,45));
            background-size: 200%;
            font-size: 1.2rem;
            color: #fff;
            font-family: 'Poppins', sans-serif;
            text-transform: uppercase;
            margin: 1rem 0;
            cursor: pointer;
            transition: .5s;
        }

            .add_Contact_button:hover {
                box-shadow: 1px 1px 4px black;
            }

        .contact_found, server_error {
            color: rgb(255,82,82);
            position: absolute;
            top: 50%;
            display: none;
        }

        .empty_field {
            color: rgb(255,82,82);
            position: absolute;
            top: 70%;
            left: 50%;
            display: none;
        }
    </style>
</head>

<h2 class="content-block">@Localizer["AddContact"]</h2>
<div class="add_contact_form">
    <div class="contact_found">
        @Localizer["AlreadyExists"]
    </div>
    <div class="server_error">
        @Localizer["InternalError"]
    </div>
    <div class="empty_field">
        @Localizer["MissingArgs"]
    </div>
    <form action="javascript:addContact()">
        <div class="dx-field-value">
            @(Html.DevExtreme().TextBox()
                .Mode(TextBoxMode.Text)
                .Name("ContactName")
                .Placeholder(Localizer["ContactName"].Value)
                .ElementAttr("class", "contact_input")
                .HoverStateEnabled(true)
            )
            @(Html.DevExtreme().DateBox()
                .Type(DateBoxType.Date)
                .Name("birthdayDateBox")
                .Placeholder(Localizer["Birthday"].Value)
                .Value(DateTime.Now)
                .ShowClearButton(true)
                .Max(DateTime.Now)
            )
            <br />
            <br />
            <input type="submit" value="@Localizer["AddContact"]" class="add_Contact_button" />
        </div>
    </form>
</div>


<script>
    function addContact() {
        if (!ContactName.value) {
            $(document).ready(function () {
                $('.empty_field').fadeIn(100);
            });
            return;
        } else if (!birthdayDateBox.value) {
            $(document).ready(function () {
                $(".empty_field").fadeIn(100);
            })
        } else {
            $('.empty_field').fadeOut(0);
            const xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var t = this.response;
                    var obj = JSON.parse(t);
                    var statusCode = obj.StatusCode;

                    if (statusCode == 0) {
                        $(document).ready(function () {
                            $(".contact_found").fadeOut(0, function () {
                                $(".server_error").fadeOut(0, function () {
                                    $('.empty_field').fadeOut(0)
                                })
                            })
                        });
                        window.location = '/';

                    } else {
                        console.log('bad');
                    }
                    if (statusCode == 103) {
                        $(document).ready(function () {
                            $(".server_error").fadeIn(100);
                        })
                    } else {
                        $('.server_error').fadeOut(0)
                    }
                    if (statusCode == 105) {
                        $(".contact_found").fadeIn(100);
                    } else {
                        $('.contact_found').fadeOut(0);
                    }
                }
            }
            var contact = ContactName.value;
            const fd = new FormData();
            fd.append("Name", contact);
            fd.append('Birthday', birthdayDateBox.value)
            xhr.open("POST", "api/Contacts/addContact", true);
            xhr.send(fd);
        }

    }
</script>

